<!DOCTYPE html>
<html>
  <head>
    <title>CasperJS - Hands On</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; font-size: 0.80em; }
      .remark-slide-content { padding: 0.5em 3em 0.5em 3em;}
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Richard Wilde 
## @rippo

---

class: center, middle

# Why test the UI? 
## (end-to-end testing)

---

# What is PhantomJS?

PhantomJS is a headless WebKit scriptable with a JavaScript API. It has fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.

* Full web stack
* No browser required

# What is CasperJS?

CasperJS is a navigation scripting & testing utility written in Javascript that depends on PhantomJS a headless browser. CasperJS eases the process of defining a full navigation scenario and provides useful high-level functions, methods & syntactic sugar for doing common tasks such as:

* testing your ui
* screen scraping including screen grabs



---

# Hands on Agenda

1. Getting started
2. Screen grab demo
3. Test 1 - First test
4. Test 2 - Navigation
5. Test 3 - Fill in a form
6. Test 4 - Waiting for the UI
7. Test 5 - Evaluate 
8. Test 6 - Looping

---

# Getting setup

1. Installing node http://nodejs.org/

2. Installing PhantomJs
````bat
$ npm install phantomjs -g
$ phantomjs -v
````
3. Installing CasperJS
````bat
$ npm install casperjs -g
$ casperjs --version
````
4. Get demo project from GitHub
````html
https://github.com/rippo/testing.casperjs
````

5. TWEAKS todo

6. Open CMD prompt create a folder  

---

#Exercise 1 - Screen Grab

Create a new file called grab.js

````javascript
var casper = require('casper').create();

casper.start('http://craftycoders.net', function () {
    this.echo(this.getTitle());
});

casper.thenOpen('http://www.meetup.com/Crafty-Coders', function () {
    this.echo(this.getTitle());
    this.capture("crafty.jpg");
});

casper.run();
````

Now run:-

````bat
$ casperjs grab.js
````

````bat
Home | CraftyCoders
CraftyCoders (Bromsgrove, England) - Meetup
````
Was a file called `crafty.jpg` created?

---

#Exercise 1 - Screen Grab

## What did we just do?##

* we created a new Casper instance

* we started it and opened http://craftycoders.net

* once the page has been loaded, we asked to print the title of that webpage (the content of its ````<title>```` tag)

* then we opened another url, http://www.meetup.com/Crafty-Coders

* once the new page has been loaded, we asked to print its title too

* we then took a screen grab of the page

* we executed the whole process

### How I found this useful...
---

#Exercise 2 - Our first test

Start the Visual Studio MVC project, then create a new file in your folder called `test01.js`


````javascript
casper.test.begin('Home Page Tests', 3, function (test) {

   casper.start("http://localhost:43502", function () {
      test.assertTitle("Home - CasperJS Mvc");
      test.assertTextExists("Casper MVC", "Casper MVC is present on page");
      test.assertTextExists("Ariya Hidayat", "Ariya Hidayat is present on page");
   });

   casper.run(function () {
      test.done();
   });
});
````

Now run:-

````bat
$ casperjs test test01.js
````

You should get 3 passing tests

---

#Exercise 2 - Our first test

## What did we just do?##

* notice test scripts are slightly different to scraping scripts

* we do not need to create a new casper instance (allows us to chain tests)

* we opened http://localhost:43502

* once the page has been loaded, we asserted the title was `Home - CasperJS Mvc`

* we then asserted that two pieces of text existed

* we ran the tests and informed CasperJS we were done 

---

#Exercise 3 - Navigation test

* **CSS Selector Tester**

    Test your css selector by using this quick script

    [Css Selector Tester](https://chrome.google.com/webstore/detail/css-selector-tester/bbklnaodgoocmcdejoalmbjihhdkbfon)

    On the home page try out 

    `````css
    ul > li:nth-child(2) > a
    `````


---


#Exercise 3 - Navigation test

Create a new file called `test02.js`

````javascript
casper.test.begin('Home and About Page', 4, function (test) {

  casper.start("http://localhost:43502/", function () {
      test.assertTitle("Home - CasperJS Mvc");
      test.assertTextExists("Casper MVC", "Casper MVC is present on page");
  });

  casper.thenClick('ul > li:nth-child(2) > a', function () {
      test.assertUrlMatch(/Home\/About/, "URL ends with Home/About");
      test.assertTitle("About - CasperJS Mvc");
  });

  casper.run(function () {
      test.done();
  });
});
````

Now run:-

````bat
$ casperjs test test02.js
````

You should get 4 passing tests

---

#Exercise 4 - Fill in a form

Copy `\_test_template.js` and rename to `test03.js`, we want to test the contact form:-

* assert the title is correct
* assert the form exists
* submit the form with just the name filled in
* assert an error comes back
* submit the form with an invalid email address
* assert an error comes back
* submit the form with an valid email address
* assert we are showing the thank you page


````javascript
test.assertTitle("Contact - CasperJS Mvc");

test.assertExists('form[action="/home/contact"]');

this.fillSelectors('form', {
    "input[name='ContactName']": 'Richard Wilde',
}, true);

casper.waitForUrl(/home\/contact/, ... 

test.assertTextExists("..." 

casper.waitForUrl(/home\/thanks/, function () {

test.assertTextExists("Thanks", "Thanks header is shown");
````

---

#Exercise 5 - UI Timings

Copy `\_test_template.js` and rename to `test04.js`, we want to test the modal window:-

---

#Exercise 6 - Evaulate

Copy `\_test_template.js` and rename to `test05.js`, we want to test the modal window:-

---

#Exercise 7 - Looping

Copy `\_test_template.js` and rename to `test06.js`, we want to test the wizard:-

---


#Check out these tools

* Resurretco

* CasperJS IDE

---

class: center, middle

#Thanks

##Hope you found it useful

Ask me questions on twitter @rippo
    </textarea>
    <script src="http://gnab.github.io/remark/downloads/remark-latest.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({  highlightStyle: 'monokai'});
    </script>
  </body>
</html>